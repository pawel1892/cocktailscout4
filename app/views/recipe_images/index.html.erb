<div class="mb-8 flex flex-col sm:flex-row items-center justify-between gap-4">
  <h1 class="text-3xl font-bold">Cocktailgalerie</h1>
  <div class="text-sm text-gray-500">
    <%= @pagy.count %> <%= RecipeImage.model_name.human(count: @pagy.count) %> gefunden
  </div>
</div>

<!-- Filter Bar -->
<% if params[:user_id].present? || params[:q].present? %>
  <div class="mb-4 p-4 bg-green-50 border border-green-200 rounded-lg flex flex-wrap items-center gap-3">
    <span class="font-medium text-green-900">Aktive Filter:</span>
    <% if params[:q].present? %>
      <span class="bg-white text-green-800 border border-green-200 px-2 py-1 rounded text-sm flex items-center gap-2 shadow-sm">
        Suche: <%= params[:q] %>
        <%= link_to recipe_images_path(params.permit(:user_id)), class: "text-green-600 hover:text-green-800" do %>
          <i class="fas fa-times"></i>
        <% end %>
      </span>
    <% end %>
    <% if @filter_user %>
      <span class="bg-white text-green-800 border border-green-200 px-2 py-1 rounded text-sm flex items-center gap-2 shadow-sm">
        Benutzer: <%= @filter_user.username %>
        <%= link_to recipe_images_path(params.permit(:q)), class: "text-green-600 hover:text-green-800" do %>
          <i class="fas fa-times"></i>
        <% end %>
      </span>
    <% end %>
    <%= link_to "Alle Filter zurÃ¼cksetzen", recipe_images_path, class: "text-sm text-green-700 hover:text-green-900 underline ml-auto" %>
  </div>
<% end %>

<div class="mb-6 bg-white p-4 rounded-lg shadow-sm border border-gray-100">
  <%= form_with url: recipe_images_path, method: :get, class: "flex flex-wrap gap-4 items-end", data: { turbo_frame: "_top" } do |f| %>
    <div class="flex flex-col gap-1 min-w-[200px] flex-1">
      <%= f.label :q, "Rezeptname", class: "label-field mb-0" %>
      <div class="relative">
        <%= f.text_field :q, value: params[:q], placeholder: "Rezeptname...", class: "input-field py-1.5 text-sm pl-8" %>
        <i class="fas fa-search absolute left-2.5 top-1/2 -translate-y-1/2 text-gray-400 text-xs"></i>
      </div>
    </div>
    <div class="flex flex-col gap-1 min-w-[150px] flex-1">
      <label class="label-field mb-0">Benutzer</label>
      <user-autocomplete
        initial-username="<%= @filter_user&.username %>"
        initial-user-id="<%= params[:user_id] %>"
      ></user-autocomplete>
    </div>
    <div class="flex gap-2">
      <%= f.submit "Filtern", class: "btn btn-primary btn-sm h-[34px]" %>
    </div>
  <% end %>
</div>

<% if @pagy.pages > 1 %>
  <div class="flex justify-center mb-6">
    <%== @pagy.series_nav %>
  </div>
<% end %>

<gallery-viewer id="gallery-viewer"></gallery-viewer>

<% if @pagy.pages > 1 %>
  <div class="flex justify-center py-8">
    <%== @pagy.series_nav %>
  </div>
<% end %>

<script>
  window.galleryImages = <%= raw @recipe_images.select { |image| image.image.attached? }.map { |image|
    {
      id: image.id,
      thumbnailUrl: url_for(image.image.variant(:medium)),
      largeUrl: url_for(image.image.variant(:large)),
      recipeTitle: image.recipe.title,
      recipeUrl: recipe_path(image.recipe),
      userBadge: user_badge(image.user),
      uploadDate: l(image.created_at.to_date)
    }
  }.to_json %>;
</script>
