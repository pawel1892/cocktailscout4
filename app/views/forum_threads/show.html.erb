<%= render "forum/forum_header", forum_topic: @forum_topic, forum_thread: @forum_thread, active: :post %>

<div class="flex flex-col gap-6">
  <%# Thread Title & Meta %>
  <div class="card bg-gray-50 border-cs-gold/30">
    <div class="card-body p-4 lg:p-6">
      <div class="flex flex-col lg:flex-row lg:items-center justify-between gap-4">
        <div>
          <h1 class="text-2xl font-bold text-gray-900 mb-1">
            <% if @forum_thread.sticky %>
              <i class="fas fa-thumbtack text-cs-gold mr-2" title="Angepinnt"></i>
            <% end %>
            <% if @forum_thread.locked %>
              <i class="fas fa-lock text-gray-500 mr-2" title="Gesperrt"></i>
            <% end %>
            <%= @forum_thread.title %>
          </h1>
          <div class="text-sm text-gray-500 flex items-center gap-3">
            <span>Gestartet von <%= user_badge(@forum_thread.user) %></span>
            <span>•</span>
            <span><%= l(@forum_thread.created_at, format: :short) %></span>
          </div>
        </div>
        <div class="flex items-center gap-2">
           <span class="tag tag-neutral"><i class="far fa-eye mr-1"></i> <%= @forum_thread.views %> Aufrufe</span>
           <span class="tag tag-neutral"><i class="far fa-comments mr-1"></i> <%= @forum_thread.count_posts %> Beiträge</span>
        </div>
      </div>
    </div>
  </div>

  <%# Moderation Controls %>
  <% if Current.user&.can_moderate_forum? %>
    <div class="flex flex-wrap gap-2">
      <% if @forum_thread.locked %>
        <%= button_to unlock_forum_thread_path(@forum_thread), method: :delete, class: 'btn btn-sm btn-secondary' do %>
          <i class="fas fa-unlock mr-1"></i> Entsperren
        <% end %>
      <% else %>
        <%= button_to lock_forum_thread_path(@forum_thread), method: :post, class: 'btn btn-sm btn-secondary' do %>
          <i class="fas fa-lock mr-1"></i> Sperren
        <% end %>
      <% end %>

      <% if @forum_thread.sticky %>
        <%= button_to unpin_forum_thread_path(@forum_thread), method: :delete, class: 'btn btn-sm btn-secondary' do %>
          <i class="fas fa-thumbtack mr-1"></i> Loslösen
        <% end %>
      <% else %>
        <%= button_to pin_forum_thread_path(@forum_thread), method: :post, class: 'btn btn-sm btn-secondary' do %>
          <i class="fas fa-thumbtack mr-1"></i> Anpinnen
        <% end %>
      <% end %>
    </div>
  <% end %>

  <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4">
    <% if @forum_thread.locked %>
      <% if Current.user&.can_moderate_forum? %>
        <%= link_to new_forum_post_path(@forum_thread), class: 'btn btn-primary w-full sm:w-auto' do %>
          <i class="fas fa-reply mr-2"></i> Antworten (als Moderator)
        <% end %>
      <% else %>
        <div class="text-gray-600 italic w-full sm:w-auto">
          <i class="fas fa-lock mr-2"></i> Dieser Thread ist geschlossen
        </div>
      <% end %>
    <% else %>
      <%= link_to new_forum_post_path(@forum_thread), class: 'btn btn-primary w-full sm:w-auto' do %>
        <i class="fas fa-reply mr-2"></i> Antworten
      <% end %>
    <% end %>

    <% if @pagy.pages > 1 %>
      <div class="w-full sm:w-auto overflow-x-auto py-2">
        <%== @pagy.series_nav %>
      </div>
    <% end %>
  </div>

  <%# Posts List %>
  <div class="space-y-6">
    <% @forum_posts.each do |forum_post| %>
      <%= render 'forum_posts/forum_post', forum_post: forum_post %>
    <% end %>
  </div>

  <%# Bottom Pagination and Actions %>
  <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mt-4">
    <% if @forum_thread.locked %>
      <% if Current.user&.can_moderate_forum? %>
        <%= link_to new_forum_post_path(@forum_thread), class: 'btn btn-primary w-full sm:w-auto' do %>
          <i class="fas fa-reply mr-2"></i> Antworten (als Moderator)
        <% end %>
      <% else %>
        <div class="text-gray-600 italic w-full sm:w-auto">
          <i class="fas fa-lock mr-2"></i> Dieser Thread ist geschlossen
        </div>
      <% end %>
    <% else %>
      <%= link_to new_forum_post_path(@forum_thread), class: 'btn btn-primary w-full sm:w-auto' do %>
        <i class="fas fa-reply mr-2"></i> Antworten
      <% end %>
    <% end %>

    <% if @pagy.pages > 1 %>
      <div class="w-full sm:w-auto overflow-x-auto py-2">
        <%== @pagy.series_nav %>
      </div>
    <% end %>
  </div>
</div>
