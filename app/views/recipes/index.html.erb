<% content_for :head do %>
  <%= pagy_seo_tags(@pagy) %>
<% end %>

<div class="mb-8 flex flex-col sm:flex-row items-center justify-between gap-4">
  <h1 class="text-3xl font-bold">Rezepte</h1>
  <div class="text-sm text-gray-500">
    <%= @pagy.count %> <%= Recipe.model_name.human(count: @pagy.count) %> gefunden
  </div>
</div>

<!-- Sort Bar -->
<div class="mb-6 flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-gray-600 bg-gray-50 p-3 rounded-lg border border-gray-100">
  <span class="font-medium text-gray-900">Sortieren:</span>
  <%= sortable "title", Recipe.human_attribute_name(:title) %>
  <%= sortable "average_rating", Recipe.human_attribute_name(:average_rating) %>
  <%= sortable "users.username", Recipe.human_attribute_name(:user) %>
  <%= sortable "alcohol_content", Recipe.human_attribute_name(:alcohol_content) %>
  <%= sortable "visits_count", Recipe.human_attribute_name(:visits_count) %>
</div>

<div class="flex justify-center mb-6">
  <%== @pagy.series_nav %>
</div>

<div class="space-y-4">
  <% @recipes.each do |recipe| %>
    <div class="card hover:shadow-md transition-all duration-200 group">
      <div class="card-body p-4">
        <div class="flex gap-4">
          <!-- Thumbnail -->
          <div class="flex-shrink-0">
             <%= link_to recipe_path(recipe) do %>
               <%= recipe_thumbnail(recipe, size_class: "w-20 h-20 sm:w-24 sm:h-24") %>
             <% end %>
          </div>

          <!-- Content -->
          <div class="flex-1 min-w-0">
            <div class="flex justify-between items-start gap-2">
               <div class="min-w-0">
                  <%= link_to recipe.title, recipe_path(recipe), class: "link font-bold text-lg leading-tight block mb-1 truncate group-hover:text-cs-gold transition-colors" %>
                  <div class="text-xs text-gray-500 mb-2 flex flex-wrap items-center gap-1">
                    <span>von</span>
                    <%= user_badge(recipe.user) %>
                  </div>
               </div>
               <div class="flex flex-col items-center gap-1">
                 <div class="<%= rating_badge_class(recipe.average_rating) %> px-2 py-1 md:px-3 md:py-2 md:text-lg rounded text-sm font-bold whitespace-nowrap min-w-[3rem] md:min-w-[4rem] text-center">
                    <%= number_with_precision(recipe.average_rating, precision: 1, separator: ",") %>
                 </div>
                 <span class="text-[10px] text-gray-400 font-normal">(<%= recipe.ratings_count %>)</span>
               </div>
            </div>

            <% if recipe.tag_list.any? %>
                <div class="flex flex-wrap gap-1.5 mb-2">
                  <% recipe.tag_list.each do |tag| %>
                    <span class="tag-mini">
                      <%= tag %>
                    </span>
                  <% end %>
                </div>
            <% end %>

            <div class="flex flex-wrap items-center gap-x-4 gap-y-2 text-xs text-gray-400 mt-2">
               <% if recipe.alcohol_content.present? %>
                 <span title="<%= Recipe.human_attribute_name(:alcohol_content) %>" class="flex items-center gap-1">
                   <i class="fas fa-wine-glass-alt"></i> <%= number_to_percentage recipe.alcohol_content, precision: 1 %>
                 </span>
               <% end %>
               <span title="<%= Recipe.human_attribute_name(:visits_count) %>" class="flex items-center gap-1">
                 <i class="far fa-eye"></i> <%= number_with_delimiter recipe.visits_count %>
               </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="flex justify-center py-8">
  <%== @pagy.series_nav %>
</div>
