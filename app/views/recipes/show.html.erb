<h1><%= @recipe.title %></h1>

<% if @recipe.recipe_images.approved.any? %>
  <div class="mb-8 grid grid-cols-2 md:grid-cols-4 gap-4">
    <% @recipe.recipe_images.approved.each do |image| %>
      <div class="aspect-square bg-gray-100 rounded-lg overflow-hidden">
         <% if recipe_image_url(image, style: :medium) %>
            <%= image_tag recipe_image_url(image, style: :medium), class: "object-cover w-full h-full", alt: @recipe.title %>
         <% end %>
      </div>
    <% end %>
  </div>
<% end %>

<div class="mb-6">
  <rating-control 
    rateable-type="Recipe" 
    :rateable-id="<%= @recipe.id %>" 
    :initial-average="<%= @recipe.average_rating || 0 %>"
    :initial-count="<%= @recipe.ratings_count || 0 %>"
    :user-rating="<%= (Current.user && @recipe.ratings.find_by(user: Current.user)&.score) || 'null' %>"
  ></rating-control>
</div>

<p>
  <strong>Autor:</strong> <%= @recipe.user.username %>
</p>

<% if @recipe.description.present? %>
  <div class="description">
    <%= simple_format @recipe.description %>
  </div>
<% end %>

<h2>Zutaten</h2>
<ul>
  <% @recipe.recipe_ingredients.each do |ri| %>
    <li>
      <%= ri.amount %> <%= ri.unit %> <%= ri.ingredient.name %>
      <% if ri.description.present? %>
        (<%= ri.description %>)
      <% end %>
    </li>
  <% end %>
</ul>

<p>
  <strong>Alkoholgehalt:</strong> <%= @recipe.alcohol_content %>%<br>
  <strong>Gesamtvolumen:</strong> <%= @recipe.total_volume %> cl
</p>

<% if @recipe.recipe_comments.any? %>
  <div id="comments">
    <h2>Kommentare</h2>
    <% @recipe.recipe_comments.each do |comment| %>
      <div class="comment">
        <p class="flex items-center gap-2">
          <%= user_badge(comment.user) %>
          <small><%= l comment.created_at, format: :short %></small>
        </p>
        <%= simple_format comment.body %>
      </div>
    <% end %>
  </div>
<% end %>
