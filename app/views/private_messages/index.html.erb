<div class="flex flex-col gap-6">
  <%# Header %>
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <h1 class="text-3xl font-bold text-cs-dark-red">Posteingang</h1>
    <%= link_to new_private_message_path, class: 'btn btn-primary' do %>
      <i class="fas fa-plus mr-2"></i> Neue Nachricht
    <% end %>
  </div>

  <%# Tab Navigation %>
  <nav class="flex gap-2 border-b border-gray-200">
    <%= link_to private_messages_path,
      class: "px-4 py-2 font-medium border-b-2 border-cs-dark-red text-cs-dark-red" do %>
      Empfangen
    <% end %>
    <%= link_to sent_private_messages_path,
      class: "px-4 py-2 font-medium text-gray-500 hover:text-cs-dark-red hover:border-gray-300 border-b-2 border-transparent" do %>
      Gesendet
    <% end %>
  </nav>

  <% if @messages.any? %>
    <%# Mobile View (Cards) %>
    <div class="lg:hidden space-y-3">
      <% @messages.each do |message| %>
        <% is_unread = !message.read %>
        <div class="card">
          <div class="card-body p-4">
            <div class="flex items-start justify-between mb-2">
              <h3 class="text-base font-bold <%= 'text-cs-dark-red' if is_unread %>">
                <%= link_to message.subject, private_message_path(message),
                  class: "link hover:underline" %>
                <% if is_unread %>
                  <span class="ml-2 inline-block w-2 h-2 bg-cs-dark-red rounded-full"></span>
                <% end %>
              </h3>
            </div>

            <div class="text-sm text-gray-600 mb-2">
              Von: <%= user_badge(message.sender) %>
            </div>

            <div class="text-xs text-gray-400">
              <%= time_ago_in_words(message.created_at) %>
            </div>

            <div class="mt-3 flex gap-2">
              <%= link_to private_message_path(message), class: "btn btn-sm btn-outline" do %>
                <i class="fas fa-eye mr-1"></i> Lesen
              <% end %>
              <%= button_to private_message_path(message), method: :delete,
                form: { data: { turbo_confirm: 'Nachricht löschen?' } },
                class: "btn btn-sm btn-outline text-red-600 hover:bg-red-50" do %>
                <i class="fas fa-trash"></i>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <%# Desktop View (Table) %>
    <div class="hidden lg:block table-container">
      <table class="table-standard">
        <thead>
          <tr>
            <th class="table-th w-auto">Von</th>
            <th class="table-th w-auto">Betreff</th>
            <th class="table-th w-32">Datum</th>
            <th class="table-th w-32 text-center">Aktionen</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          <% @messages.each do |message| %>
            <% is_unread = !message.read %>
            <tr class="table-tr-hover">
              <td class="table-td">
                <%= user_badge(message.sender) %>
              </td>
              <td class="table-td">
                <%= link_to message.subject, private_message_path(message),
                  class: "link hover:underline #{'font-bold' if is_unread}" %>
                <% if is_unread %>
                  <span class="ml-2 inline-block w-2 h-2 bg-cs-dark-red rounded-full"></span>
                <% end %>
              </td>
              <td class="table-td text-gray-500 text-sm">
                <%= message.created_at.strftime("%d.%m.%Y") %>
              </td>
              <td class="table-td text-center">
                <div class="flex gap-2 justify-center">
                  <%= link_to private_message_path(message),
                    class: "text-gray-400 hover:text-cs-dark-red" do %>
                    <i class="fas fa-eye"></i>
                  <% end %>
                  <%= button_to private_message_path(message), method: :delete,
                    form: { data: { turbo_confirm: 'Nachricht löschen?' } },
                    class: "text-gray-400 hover:text-red-600" do %>
                    <i class="fas fa-trash"></i>
                  <% end %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="text-center py-12 text-gray-500">
      <i class="fas fa-inbox text-4xl mb-4"></i>
      <p>Keine Nachrichten im Posteingang</p>
    </div>
  <% end %>

  <%# Pagination %>
  <% if @pagy.pages > 1 %>
    <div class="flex justify-center">
      <%== @pagy.series_nav %>
    </div>
  <% end %>
</div>
