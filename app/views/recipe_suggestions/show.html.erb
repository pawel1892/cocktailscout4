<% content_for :title, "#{@suggestion.title} - Rezeptvorschlag - CocktailScout" %>

<div class="max-w-4xl mx-auto px-4 py-8">
  <div class="mb-6">
    <%= link_to recipe_suggestions_path, class: "link flex items-center gap-1 text-sm mb-4" do %>
      <i class="fas fa-chevron-left"></i>
      Zurück zur Übersicht
    <% end %>

    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
      <h1 class="text-3xl font-bold text-gray-900"><%= @suggestion.title %></h1>
      <% if @suggestion.editable_by?(Current.user) %>
        <%= link_to edit_recipe_suggestion_path(@suggestion), class: "btn btn-primary" do %>
          <i class="fa-solid fa-edit"></i>
          Bearbeiten
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Status Card -->
  <div class="card p-6 mb-6">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-lg font-semibold text-gray-900">Status</h2>
      <%= render "shared/suggestion_status_badge", suggestion: @suggestion %>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
      <div>
        <span class="text-gray-600">Eingereicht:</span>
        <span class="font-medium"><%= l(@suggestion.created_at, format: :long) %></span>
      </div>

      <% if @suggestion.reviewed_at %>
        <div>
          <span class="text-gray-600">Geprüft:</span>
          <span class="font-medium"><%= l(@suggestion.reviewed_at, format: :long) %></span>
        </div>
      <% end %>

      <% if @suggestion.reviewed_by %>
        <div>
          <span class="text-gray-600">Geprüft von:</span>
          <span class="font-medium"><%= @suggestion.reviewed_by.username %></span>
        </div>
      <% end %>
    </div>

    <!-- Feedback for rejected suggestions -->
    <% if @suggestion.status_rejected? && @suggestion.feedback.present? %>
      <div class="bg-red-50 border border-red-200 rounded-lg p-4 mt-4">
        <p class="font-semibold text-red-900 mb-1 flex items-center gap-2">
          <i class="fa-solid fa-exclamation-triangle"></i>
          Ablehnungsgrund:
        </p>
        <p class="text-red-800"><%= simple_format(@suggestion.feedback) %></p>
      </div>
    <% end %>

    <!-- Published recipe link for approved suggestions -->
    <% if @suggestion.status_approved? && @suggestion.published_recipe %>
      <div class="bg-green-50 border border-green-200 rounded-lg p-4 mt-4">
        <p class="font-semibold text-green-900 mb-1 flex items-center gap-2">
          <i class="fa-solid fa-check-circle"></i>
          Veröffentlicht als:
        </p>
        <%= link_to recipe_path(@suggestion.published_recipe.slug), class: "text-green-800 link text-lg" do %>
          <%= @suggestion.published_recipe.title %>
          <i class="fa-solid fa-arrow-right ml-1"></i>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Recipe Details -->
  <div class="card p-6 mb-6">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Beschreibung</h2>
    <div class="prose max-w-none">
      <%= simple_format(@suggestion.description) %>
    </div>
  </div>

  <!-- Tags -->
  <% if @suggestion.tag_list.present? %>
    <div class="card p-6 mb-6">
      <h2 class="text-lg font-semibold text-gray-900 mb-4">Tags</h2>
      <div class="flex flex-wrap gap-2">
        <% @suggestion.tag_list.split(',').map(&:strip).each do |tag| %>
          <span class="inline-flex items-center px-3 py-1 text-sm font-medium bg-gray-100 text-gray-800 rounded-full">
            <%= tag %>
          </span>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- Ingredients -->
  <div class="card p-6">
    <h2 class="text-lg font-semibold text-gray-900 mb-4">Zutaten</h2>
    <ul class="space-y-2">
      <% @suggestion.recipe_suggestion_ingredients.each do |rsi| %>
        <li class="flex items-start gap-2">
          <i class="fa-solid fa-circle text-xs text-gray-400 mt-1.5"></i>
          <span>
            <% if rsi.amount && rsi.unit %>
              <strong><%= rsi.amount %> <%= rsi.unit.display_name_for(rsi.amount) %></strong>
            <% elsif rsi.amount %>
              <strong><%= rsi.amount %>x</strong>
            <% end %>
            <%= rsi.display_name.presence || rsi.ingredient.name %>
            <% if rsi.additional_info.present? %>
              <span class="text-gray-600">(<%= rsi.additional_info %>)</span>
            <% end %>
            <% if rsi.is_optional %>
              <span class="text-sm text-gray-500 italic">(optional)</span>
            <% end %>
          </span>
        </li>
      <% end %>
    </ul>
  </div>
</div>
